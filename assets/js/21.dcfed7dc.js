(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{223:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_06，tree和blob"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_06，tree和blob"}},[t._v("#")]),t._v(" 06，tree和blob")]),t._v(" "),a("blockquote",[a("p",[t._v("文章中使用的 "),a("code",[t._v("git cat-file")]),t._v(" 相关命令，参考"),a("a",{attrs:{href:"https://crane0.github.io/blog/git/04.git%E6%96%87%E4%BB%B6.html#_5%EF%BC%8C%E5%85%B6%E4%BB%96",target:"_blank",rel:"noopener noreferrer"}},[t._v("04.git文件"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"_1，介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1，介绍"}},[t._v("#")]),t._v(" 1，介绍")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://crane0.oss-cn-beijing.aliyuncs.com/blogMarkdown/gitgit06-1.png",alt:"git06-1"}})]),t._v(" "),a("p",[t._v("首先，1个commit只会对应 1个 tree，这个 tree 可以理解为，是那个 commit 创建的快照。")]),t._v(" "),a("p",[t._v("这个快照中，就是一个文件目录，该目录中可能还有嵌套的目录和文件。")]),t._v(" "),a("p",[t._v("所以，目录中的 tree 可以理解为是 1个文件夹，blob 可以理解为是 1个文件。")]),t._v(" "),a("p",[t._v("在 git 的设计中，只要 2个或多个文件完全相同，那就是 1个唯一的 blob，用这个来标识文件。")]),t._v(" "),a("p",[t._v("上图对应的文件展示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://crane0.oss-cn-beijing.aliyuncs.com/blogMarkdown/gitgit06-2.png",alt:"git06-2"}})]),t._v(" "),a("h2",{attrs:{id:"_2，tree的个数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2，tree的个数"}},[t._v("#")]),t._v(" 2，tree的个数")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://crane0.oss-cn-beijing.aliyuncs.com/blogMarkdown/gitgit06-3.png",alt:"git06-3"}})]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" init watch_git_objects\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" watch_git_objects\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" doc\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" doc\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" hello "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" readme\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" doc\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("会发现 "),a("code",[t._v(".git/objects")]),t._v(" 下多了一个 blob 类型文件，内容就是 readme 的内容")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://crane0.oss-cn-beijing.aliyuncs.com/blogMarkdown/gitgit06-4.png",alt:"git06-4"}})]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"add readme"')]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("执行 commit 之后，会发现有 4个文件，")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("commit，6652f71，包含了1个tree（暂时命名为"),a("strong",[t._v("treeA")]),t._v("）")])]),t._v(" "),a("li",[a("p",[t._v("tree（"),a("strong",[t._v("treeA")]),t._v("），315f8050，包含了1个 tree 类型（暂时命名为"),a("strong",[t._v("treeB")]),t._v("）的 doc 文件。")])]),t._v(" "),a("li",[a("p",[t._v("tree（"),a("strong",[t._v("treeB")]),t._v("），6e17e262，包含了1个 blob 类型（暂时命名为"),a("strong",[t._v("blobA")]),t._v("）的 readme 文件。")])]),t._v(" "),a("li",[a("p",[t._v("blob（"),a("strong",[t._v("blobA")]),t._v("），ce013625，就是 readme 文件。")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://crane0.oss-cn-beijing.aliyuncs.com/blogMarkdown/gitgit06-5.png",alt:"git06-5"}})]),t._v(" "),a("h2",{attrs:{id:"_3，git底层的大致运行流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3，git底层的大致运行流程"}},[t._v("#")]),t._v(" 3，git底层的大致运行流程")]),t._v(" "),a("p",[t._v("当添加或者修改了文件并且 add 到暂存区后，首先会根据文件内容创建不同的 blob。")]),t._v(" "),a("p",[t._v("当进行 commit 时，会创建一个 tree 组件把需要的 blob 组件添加进去之后，封装到一个 commit 组件中完成本次提交。")]),t._v(" "),a("p",[t._v("在使用 "),a("code",[t._v("git reset --hard [commit_hash]")]),t._v(" 恢复到某个特定的版本时，git 会根据这个 commit 组件的 commit_hash 快速的找到 tree 组件，然后根据 tree 找到blob组件，之后对仓库进行还原。")]),t._v(" "),a("p",[t._v("整个过程都是以 hash 和二进制进行操作，所以 git 执行效率很高。")])])}),[],!1,null,null,null);s.default=n.exports}}]);